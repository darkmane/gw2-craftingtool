<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="gw2-item.html">
<script src="../scripts/gw2.js"></script>

<dom-module id="gw2-recipe">
  <template>
    <div>
      <gw2-item item_id="{{item_id}}"></gw2-item>
      <paper-icon-button id="drawer_button" icon="hardware:keyboard-arrow-down" title="more info"
                         style="float:right;"></paper-icon-button>
      <iron-request id="xhr"></iron-request>
      <!-- Request Recipe for Item -->
			<iron-collapse id="recipe_info">
        <div class="collapse_content">
          <template is="dom-repeat" items="{{ingredient_in}}">
            <div>{{item}}</div>
          </template>
        </div>
      </iron-collapse>
      <!-- Request List of ingredients from -->
    </div>
  </template>
  <script>
    Polymer({
      is: 'gw2-recipe',
      properties: {
        item_id: {
          type: Number,
          reflectToAttribute: true
        },
        recipe: {
          type: Object,
          notify: true

        },
        ingredient_in: {
          type:Array,
          readOnly: true
        }
      },

      listeners: {
        'drawer_button.tap': 'toggle'
      },
      toggle: function (event) {

        console.log('Hit toggle');
        var moreInfo = this.$.recipe_info;
        var iconButton = Polymer.dom(event).localTarget;
        iconButton.icon = moreInfo.opened ? 'hardware:keyboard-arrow-down' : 'hardware:keyboard-arrow-up';
        moreInfo.toggle();
      },
      get_recipe: function(){
        return getJSON(BASE_URI + "/v2/recipes/search?output=" + this.item_id).then(function(recipe_id){
          return getJSON(BASE_URI + "/v2/recipes/" + recipe_id);
        }).then(function(recipe){
          this.recipe = recipe;
        }.bind(this));
      }

    });


  </script>
</dom-module>
